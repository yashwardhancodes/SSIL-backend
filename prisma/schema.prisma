generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/* ====================== PARTY ====================== */
model Party {
  id             Int      @id @default(autoincrement())
  name           String
  type           String   // 'customer' or 'supplier'
  contact        String?
  address        String?
  gstin          String?
  state          String?
  stateCode      String?
  openingBalance Float?   @default(0)
  currentBalance Float?   @default(0)
  createdAt      DateTime @default(now())

  invoices Invoice[]
  payments Payment[]
}

/* ====================== ITEM ====================== */
model Item {
  id            Int      @id @default(autoincrement())
  name          String
  hsnSac        String?
  unit          String   // pcs, kg, Month, etc.
  purchaseRate  Float    @default(0)
  saleRate      Float    @default(0)
  taxRate       Float    @default(18)
  currentStock  Float    @default(0)
  lowStockAlert Float?
  createdAt     DateTime @default(now())

  invoiceItems  InvoiceItem[]
}

/* ====================== INVOICE ====================== */
model Invoice {
  id              Int      @id @default(autoincrement())
  invoiceNumber   String   @unique
  type            String   // 'sale' or 'purchase'
  date            DateTime @default(now())

  partyId         Int
  party           Party    @relation(fields: [partyId], references: [id])

  siteName        String?
  particular      String?

  subTotal        Float
  cgstRate        Float    @default(9)
  sgstRate        Float    @default(9)
  igstRate        Float    @default(0)
  cgstAmount      Float    @default(0)
  sgstAmount      Float    @default(0)
  igstAmount      Float    @default(0)
  discount        Float    @default(0)
  roundOff        Float    @default(0)
  grandTotal      Float
  amountInWords   String?
  paidAmount      Float    @default(0)
  balance         Float
  status          String   @default("draft")

  createdAt       DateTime @default(now())
  items           InvoiceItem[]
  payments        Payment[]
}

/* ====================== INVOICE ITEM ====================== */
model InvoiceItem {
  id          Int     @id @default(autoincrement())
  invoiceId   Int
  invoice     Invoice @relation(fields: [invoiceId], references: [id])

  itemId      Int?
  item        Item?   @relation(fields: [itemId], references: [id])

  // ────── NEW FIELDS (ALL OPTIONAL OR WITH DEFAULT) ──────
  hsnSac      String?           // e.g., "997319"
  particular  String?           // "JCB Hired on Monthly Basis..."
  description String?
  quantity    Float     @default(1)
  unit        String?           // "Month", "Day", etc.
  rate        Float     @default(0)
  amount      Float     @default(0)    // quantity × rate
  taxRate     Float     @default(18)
  taxAmount   Float     @default(0)
  total       Float     @default(0)    // amount + taxAmount
}

/* ====================== PAYMENT ====================== */
model Payment {
  id        Int      @id @default(autoincrement())
  type      String   // 'in' or 'out'
  amount    Float
  mode      String?
  date      DateTime @default(now())
  note      String?

  partyId   Int
  party     Party    @relation(fields: [partyId], references: [id])

  invoiceId Int?
  invoice   Invoice? @relation(fields: [invoiceId], references: [id])

  createdAt DateTime @default(now())
}

/* ====================== EXPENSE ====================== */
model Expense {
  id        Int      @id @default(autoincrement())
  category  String
  amount    Float
  date      DateTime @default(now())
  note      String?
  createdAt DateTime @default(now())
}